
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ LeanVibe Agent Hive - Mobile Control</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0; padding: 20px; background: #1a1a2e; color: #eee;
        }
        .header { text-align: center; margin-bottom: 30px; }
        .status-card {
            background: #16213e; border-radius: 12px; padding: 20px; margin: 15px 0;
            border-left: 4px solid #0f3460;
        }
        .status-online { border-left-color: #00ff88; }
        .status-warning { border-left-color: #ffaa00; }
        .status-offline { border-left-color: #ff4444; }
        .metric { display: flex; justify-content: space-between; margin: 10px 0; }
        .control-btn {
            width: 100%; padding: 15px; margin: 10px 0; border: none;
            border-radius: 8px; font-size: 16px; font-weight: 600;
            cursor: pointer; transition: all 0.3s;
        }
        .btn-start { background: #00ff88; color: #000; }
        .btn-stop { background: #ff4444; color: #fff; }
        .btn-status { background: #0f7fda; color: #fff; }
        .refresh-timer { text-align: center; color: #888; margin: 20px 0; }
    </style>
    <script>
        let refreshTimer = 30;
        let systemData = {
            apiStatus: 'CHECKING...',
            activeAgents: '?/?',
            services: '?/? running'
        };
        
        // Fetch system status from API
        async function fetchSystemStatus() {
            try {
                const response = await fetch('/api/v1/system/status');
                if (response.ok) {
                    const data = await response.json();
                    systemData.apiStatus = 'ONLINE';
                    systemData.activeAgents = `${data.active_agents || 0}/${data.total_agents || 5}`;
                    systemData.services = `${data.running_services || 0}/${data.total_services || 3} running`;
                    updateDisplay();
                } else {
                    throw new Error('API response not ok');
                }
            } catch (error) {
                console.error('Failed to fetch status:', error);
                systemData.apiStatus = 'OFFLINE';
                systemData.activeAgents = '0/5';
                systemData.services = '0/3 running';
                updateDisplay();
            }
        }
        
        // Update display elements
        function updateDisplay() {
            document.querySelector('.status-card .metric:nth-child(2) span:last-child').textContent = 
                systemData.apiStatus === 'ONLINE' ? '‚úÖ ONLINE' : '‚ùå OFFLINE';
            document.querySelector('.status-card .metric:nth-child(3) span:last-child').textContent = 
                systemData.activeAgents;
            document.querySelector('.status-card .metric:nth-child(4) span:last-child').textContent = 
                systemData.services;
                
            // Update status card styling
            const statusCard = document.querySelector('.status-card');
            if (systemData.apiStatus === 'ONLINE') {
                statusCard.className = 'status-card status-online';
            } else {
                statusCard.className = 'status-card status-offline';
            }
        }
        
        function updateTimer() {
            document.getElementById('timer').textContent = refreshTimer;
            refreshTimer--;
            if (refreshTimer < 0) {
                refreshTimer = 30;
                fetchSystemStatus();
            }
        }
        
        // Execute commands via API
        async function executeCommand(cmd) {
            if (confirm(`Execute: ${cmd}?`)) {
                try {
                    const response = await fetch('/api/v1/system/command', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ command: cmd })
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        alert(`Command ${cmd} executed: ${result.message || 'Success'}`);
                        fetchSystemStatus(); // Refresh status after command
                    } else {
                        throw new Error('Command failed');
                    }
                } catch (error) {
                    console.error('Command execution failed:', error);
                    alert(`Command ${cmd} failed to execute`);
                }
            }
        }
        
        // Initialize
        window.addEventListener('load', () => {
            fetchSystemStatus();
            setInterval(updateTimer, 1000);
        });
    </script>
</head>
<body>
    <div class="header">
        <h1>üöÄ LeanVibe Agent Hive</h1>
        <p>Mobile Control Center</p>
    </div>
    
    <div class="status-card status-online">
        <h3>üåê System Status</h3>
        <div class="metric">
            <span>API Server:</span>
            <span>‚úÖ ONLINE</span>
        </div>
        <div class="metric">
            <span>Active Agents:</span>
            <span>0/5</span>
        </div>
        <div class="metric">
            <span>Services:</span>
            <span>3/2 running</span>
        </div>
    </div>
    
    <div class="status-card">
        <h3>ü§ñ Quick Actions</h3>
        <button class="control-btn btn-start" onclick="executeCommand('start')">
            üöÄ Start System
        </button>
        <button class="control-btn btn-status" onclick="executeCommand('status')">
            üìä Full Status
        </button>
        <button class="control-btn btn-stop" onclick="executeCommand('stop')">
            üõë Emergency Stop
        </button>
    </div>
    
    <div class="refresh-timer">
        Auto-refresh in <span id="timer">30</span>s
    </div>
    
    <div class="status-card">
        <h3>üì± Access Info</h3>
        <div class="metric">
            <span>Local IP:</span>
            <span>192.168.1.202</span>
        </div>
        <div class="metric">
            <span>Dashboard:</span>
            <span><a href="http://192.168.1.202:8000" style="color: #00ff88;">Dashboard</a></span>
        </div>
    </div>
</body>
</html>
